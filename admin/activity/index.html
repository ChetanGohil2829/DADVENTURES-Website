<!doctype html>
<html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dadventures â€” Activity Log</title>
<style>
:root{--gold:#e6c14a;--paper:#f7f1d0;--bg:#000}
body{background:#000;color:var(--paper);font-family:Inter,Arial,sans-serif;margin:0;padding:16px}
h1,h2{color:var(--gold);text-shadow:0 0 8px rgba(230,193,74,.55)}
.card{background:#111;border:1px solid var(--gold);border-radius:12px;box-shadow:0 0 18px rgba(230,193,74,.25);padding:16px;margin:12px 0}
.btn{background:#000;color:var(--gold);border:1px solid var(--gold);padding:8px 12px;border-radius:8px;cursor:pointer;box-shadow:0 0 6px rgba(230,193,74,.45)}
input,select{background:#000;color:#f7f1d0;border:1px solid var(--gold);border-radius:8px;padding:6px 8px}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.entry{padding:6px 0;border-bottom:1px solid rgba(230,193,74,.15)}
.badge{display:inline-block;border:1px solid var(--gold);padding:2px 6px;border-radius:6px;margin-left:6px;font-size:12px}
</style>
</head><body>
<h1>ðŸ“° Activity Log</h1>
<div class="card">
  <div class="row">
    <input id="q" placeholder="Searchâ€¦">
    <select id="type"><option value="">All Types</option><option>Page</option><option>Event</option><option>Shop</option><option>Theme</option><option>Rollback</option><option>Donation</option><option>Purchase</option><option>Contact</option><option>Demo Action</option></select>
    <select id="days"><option value="0">All time</option><option value="1">Last 24h</option><option value="7">Last 7d</option><option value="30">Last 30d</option></select>
    <button class="btn" id="csv">Export CSV</button>
    <button class="btn" id="json">Export JSON</button>
  </div>
  <div id="list"></div>
</div>
<script>
const elQ = document.getElementById('q'), elType=document.getElementById('type'), elDays=document.getElementById('days'), list=document.getElementById('list');
let data=[];
function render(){
  const q=(elQ.value||'').toLowerCase(); const ty=elType.value; const days=parseInt(elDays.value||'0');
  const now = Date.now(); const ms = days?days*86400000:0;
  const rows = data.filter(e=>{
    const t = !ty || e.type===ty;
    const d = !ms || (now - new Date(e.time).getTime()) <= ms;
    const s = !q || JSON.stringify(e).toLowerCase().includes(q);
    return t && d && s;
  });
  list.innerHTML = rows.map(e=>`<div class="entry">[${e.time}] â€” <strong>${e.type}</strong> â€” ${e.note||e.name||e.who||''} ${e.amount?('Â£'+e.amount):''} ${e.demo?'<span class="badge">Demo</span>':''}</div>`).join('') || '<em>No entries</em>';
}
fetch('../../logs/activity.json').then(r=>r.json()).then(arr=>{ data=arr; render(); });
elQ.oninput=render; elType.onchange=render; elDays.onchange=render;
document.getElementById('csv').onclick=()=>{
  const rows = [['time','type','name','who','amount','note','demo']].concat(data.map(e=>[e.time||'',e.type||'',e.name||'',e.who||'',e.amount||'',e.note||'',e.demo?'Demo':'']));
  const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='dadventures-activity.csv'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),0);
};
document.getElementById('json').onclick=()=>{
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='dadventures-activity.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),0);
};
</script>
</body></html>
